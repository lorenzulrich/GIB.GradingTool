{namespace form=TYPO3\Form\ViewHelpers}
{namespace gib=GIB\GradingTool\ViewHelpers}
<script src="{f:uri.resource(path: 'JavaScripts/jquery.autosize.min.js', package: 'GIB.GradingTool')}"></script>
<form:form action="index" object="{form}" method="post" id="{form.identifier}" enctype="multipart/form-data">
	<ul id="submissionPageOverview" class="clearfix">
	<f:for each="{form.pages}" as="page">
		<li>
			<f:if condition="{page.index} == {form.currentPage.index}">
				<f:then>
					<span class="text-primary stepNumber">{gib:calculation(expressionString: '{page.index}+1')}</span><span class="text-primary stepLabel">{page.label}</span>
				</f:then>
				<f:else>
					<span class="text-muted stepNumber">{gib:calculation(expressionString: '{page.index}+1')}</span><span class="text-muted stepLabel">{page.label}</span>
				</f:else>
			</f:if>
		</li>
	</f:for>
	</ul>

	<div class="progress progress-striped">
		<div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="{gib:calculation(expressionString: '{form.currentPage.index}+1')}" aria-valuemin="0" aria-valuemax="{form.pages -> f:count()}"></div>
	</div>
	<form:renderRenderable renderable="{form.currentPage}" />
	<div class="actions">
		<f:render partial="TYPO3.Form:Form/Navigation" arguments="{form: form}" />
	</div>
</form:form>
<script type="text/javascript">
	$(function() {
		$('.progress-bar').css("width",
			function() {
				var currentProgressPercent = ($(this).attr("aria-valuenow") / $(this).attr("aria-valuemax")) * 100;
				return Math.floor(currentProgressPercent) + '%';
			}
		);

		// all radio buttons in the form
		var $radioButtons = $(':radio', 'ul.submissionAnswer');
		$radioButtons.on('click', function(e) {
			// add styling classes to wrapper of radio
			$radioButtons.each(function() {
				$(this).closest('li').toggleClass('answerSelected', this.checked);
			});
			// display mandatory comment field on choosing "not applicable"
			var $commentFieldWrapper = $(this).closest('div.clearfix').next('div');
			if ($commentFieldWrapper.hasClass('hiddenField')) {
				if ($(e.target).attr('value') == 5) {
					$commentFieldWrapper.slideDown();
					$('textarea', $commentFieldWrapper).prop('required', true);
				} else {
					$commentFieldWrapper.slideUp();
					$('textarea', $commentFieldWrapper).prop('required', false).val('');
				}
			}
		});

		// initialize form page (necessary if user is changing to previous page)
		var $checkedRadioButtons = $('input:radio:checked');
		if ($checkedRadioButtons.length > 0){
			$checkedRadioButtons.each(function() {
				var $radio = $(this);
				$radio.closest('li').toggleClass('answerSelected', this.checked);
				if ($radio.val() == 5) {
					var $commentFieldWrapper = $(this).closest('div.clearfix').next('div');
					$commentFieldWrapper.show();
					$('textarea', $commentFieldWrapper).prop('required', true);
				}
			});
		}



		// autosize textareas
		$('textarea').autosize({append: "\n"});

	});
</script>
<style>
	.hidden { display: none; }

	ul#submissionPageOverview {
		list-style-type: none;
		margin: 0 0 20px 0;
		padding: 0;
	}

	ul#submissionPageOverview li {
		float: left;
		width: 28%;
		margin: 0 5% 10px 0;
		font-size: 14px;
		padding: 0;
		height: 24px;
	}

	ul#submissionPageOverview li span {
		display: inline-block;
		vertical-align: middle;
	}

	ul#submissionPageOverview li .stepNumber {
		font-size: 24px;
		margin-right: 10px;
		width: 25px;
	}

	ul.submissionAnswer {
		list-style: none;
		margin: 0 0 40px 0;
		padding: 0;
	}

	ul.submissionAnswer li {
		width: 16%;
		min-height: 250px;
		height: 250px;
		margin-right: 5%;
		float: left;
		border-radius: 10px;
		-moz-border-radius: 10px;
		-webkit-border-radius: 10px;
		border: 5px solid #3276b1;
	}
	ul.submissionAnswer li.answerSelected {
		background-color: #3276b1;
		color: #fff;
		-webkit-transition: all 200ms ;
		-moz-transition: all 200ms ;
		-ms-transition: all 200ms ;
		-o-transition: all 200ms ;
		transition: all 200ms ;
	}
	ul.submissionAnswer li:last-child { margin-right: 0; }
	ul.submissionAnswer li input[type=radio] {
		position: absolute;
		left: -999em;
	}
	ul.submissionAnswer label {
		padding: 10px;
		display: block;
		height: 100%;
		width: 100%;
		font-size: 12px;
		cursor: pointer;
		position: relative;
	}
	ul.submissionAnswer span {
		position: absolute;
		right: 5px;
		bottom: 5px;
		font-size: 16px;
	}

</style>